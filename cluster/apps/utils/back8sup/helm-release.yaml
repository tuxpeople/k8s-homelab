---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: back8sup
  namespace: utils
spec:
  chart:
    spec:
      version: 0.3.3
      # renovate: registryUrl=https://charts.adfinis.com
      chart: back8sup
      interval: 5m
      sourceRef:
        kind: HelmRepository
        name: adfinis
        namespace: flux-system
  interval: 5m
  test:
    enable: false # Enable helm test
  install:
    remediation: # perform remediation when helm install fails
      retries: 5
  upgrade:
    remediation: # perform remediation when helm upgrade fails
      retries: 3
      remediateLastFailure: true # remediate the last failure, when no retries remain
    cleanupOnFail: true
  rollback:
    timeout: 10m
    cleanupOnFail: true
    recreate: true
  values:
    cronjob:
      schedule: "15 * * * *"
      environment:
        - name: GENERATIONS
          value: "12"
        - name: TOKEN_FILE
          value: "/var/run/secrets/kubernetes.io/serviceaccount/token"
        - name: API_ENDPOINT
          value: "https://kubernetes.default.svc.cluster.local:443"
    configMaps:
      config.yaml: |
        global:
          - secret
        namespaces:
          - name: default
            kind:
              - deployment
              - cm
              - ingress
