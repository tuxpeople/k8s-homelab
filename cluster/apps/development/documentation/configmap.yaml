apiVersion: v1
kind: ConfigMap
metadata:
  name: docs-watch-script
data:
  watch.sh: |-
    #!/bin/sh
    while [ ! -f /git/current/mkdocs.yml ]
    do
      sleep 2
    done
    mkdocs build --config-file /git/current/mkdocs.yml --site-dir /docs
    inotifywait -q -r -m -e modify,move,create,delete /git/current/ |
    while read _; do
      cp -rH /git/current/* /docs/
      mkdocs build --config-file /git/current/mkdocs.yml --site-dir /docs
    done
