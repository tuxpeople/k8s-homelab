---
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: plex-meta-manager
  labels:
    app: plex-meta-manager
spec:
  suspend: false
  schedule: "*/10 * * * *"
  failedJobsHistoryLimit: 3
  successfulJobsHistoryLimit: 3
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: OnFailure
          dnsPolicy: ClusterFirst
          containers:
          - name: plex-meta-manager
            image: meisnate12/plex-meta-manager:latest
            imagePullPolicy: Always
            env:
            - name: PUID
              value: "1000"
            - name: GUID
              value: "1000"
            - name: TZ
              value: "Europe/Zurich"
            - name: PMM_TEST
              value: "false"
            - name: PMM_RUN
              value: "true"
            - name: PMM_TIME
              value: "14:00,05:18"
            - name: PMM_CONFIG
              value: "/myconfig/config.yml"
            volumeMounts:
            - mountPath: /config/config.yaml
              name: plex-meta-manager-config
              subPath: config.yaml
            - mountPath: /config/holiday.yaml
              name: plex-meta-manager-config
              subPath: holiday.yaml
            - mountPath: /config/movies.yaml
              name: plex-meta-manager-config
              subPath: movies.yaml
            resources:
              requests:
                memory: 500Mi
                cpu: 100m
              limits:
                memory: 2000Mi
                cpu: 500m
          volumes:
          - name: plex-meta-manager-config
            configMap:
              name: plex-meta-manager-config
              items:
              - key: config.yaml
                mode: 420
                path: config.yaml
              - key: holiday.yaml
                mode: 420
                path: holiday.yaml
              - key: movies.yaml
                mode: 420
                path: movies.yaml
