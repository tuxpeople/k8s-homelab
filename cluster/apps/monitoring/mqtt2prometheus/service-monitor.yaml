---
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  labels:
    app: mqtt2prometheus
  name: mqtt2prometheus
spec:
  endpoints:
    - interval: 1m
      path: "/metrics"
      port: metrics
      scrapeTimeout: 1m
      relabelings:
        - source_labels: ["topic"]
          target_label: location
          regex: '/devices/(.*)/.*'
          action: replace
          replacement: "$1"
  selector:
    matchLabels:
      app: mqtt2prometheus
