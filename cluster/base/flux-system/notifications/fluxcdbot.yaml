apiVersion: v1
kind: Service
metadata:
  labels:
    app.kubernetes.io/name: fluxcdbot
  name: fluxcdbot
  namespace: flux-system
spec:
  clusterIP: None
  ports:
  - name: http
    port: 8080
  selector:
    app.kubernetes.io/name: fluxcdbot
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: fluxcdbot
  namespace: flux-system
  labels:
    app.kubernetes.io/name: fluxcdbot
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: fluxcdbot
  serviceName: fluxcdbot
  template:
    metadata:
      labels:
        app.kubernetes.io/name: fluxcdbot
    spec:
      containers:
      - image: squat/fluxcdbot:0b448e7b547140f9be992c28fdbab583082fb543
        name: fluxcdbot
        args:
        - --token=$(TOKEN)
        - --url=http://fluxcdbot.flux-system.svc.cluster.local
        env:
        - name: TOKEN
          valueFrom:
            secretKeyRef:
              name: telegram-token
              key: token
        ports:
        - containerPort: 8080
          name: http
        - containerPort: 9090
          name: internal
        volumeMounts:
        - name: data
          mountPath: /var/fluxcdbot
  volumeClaimTemplates:
  - metadata:
      labels:
        app.kubernetes.io/name: fluxcdbot
      name: data
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 1Gi
---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  creationTimestamp: null
  name: fluxcdbot
  namespace: flux-system
spec:
  encryptedData:
    address: AgAjIMnpUVTen88e/FPgUQv28jvLM1EDe0+hPRdOPmAzoOR9lJgZEmDTt6+13OijKn6I6M23h08a/Q2qjZsNpKX2vX/GLsbBLQdPKlJv9zLUW3a2PVUmhPv7kIH1RP6TgPp7WOgpFCULikSTVFVzLwOuTMKPbT2V995vzi+rW2F6RnlP+AQFtDKeppNwImmvdyVGLgdzIj77zRT/iWvH9rRhEZctM2CYZLlSTD7IWfF6M48sFxDFs5Gaoet1hTLFfcnNkBm95DhUy/tSVfm/4ml3FZDDKoLuo7Fcw0m+r0ozakTBeJuIhi01KW/WI2VWWPFj5g3A3JR1t+KwOnnDrLbZnKV9fn23h5Trq9mvXcb+v7ZuJYuqpFw2SDmQEO1s19ZGgWI/h/d0gK+kxczp4EM4XM2xMUtyxnrt3nv7YK87I55fL0CVALPExGmbBeYhlFx/+uOFLbU+gPPSsHOnNXVZhc4P+oOeLVvXtYVJ6bUlp+Z+cZ9oGAolIv9mwC2mOiM0CUUZQoZ0ccLstf9r6G+Ezk29t7t2QNwfpVt3Mz18zzr4eZ3EKN7DWCAzGVQ53c6RjOdje/nnPM1bC6BhWvKfDWJA+5PlWXTNtXatV/fd4ZC4lgO1hRPHjwke968kkQDHyPHTQwPnL672RlJt6QTozWNdqQsRgvaSOohkduN/XkPcVmbR0FRVCIoI6Z+SuOF3XQPlsKoOzRlQpirxdJ8dr8V+ObhwxX/4HSpKHBoP5fIXYeFmoQ9+nNwNWyvyrU/mnMMLZCXBlN0PWYO5Tgowfl1mIRJDTaifr6+yJ0ZB0cxEccUGCTP1TWnmU8O5QBBWxGhQ4OKCZgWSlVPb
  template:
    data: null
    metadata:
      creationTimestamp: null
      name: fluxcdbot
      namespace: flux-system
