apiVersion: v1
kind: Service
metadata:
  labels:
    app.kubernetes.io/name: fluxcdbot
  name: fluxcdbot
  namespace: flux-system
spec:
  clusterIP: None
  ports:
  - name: http
    port: 8080
  selector:
    app.kubernetes.io/name: fluxcdbot
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: fluxcdbot
  namespace: flux-system
  labels:
    app.kubernetes.io/name: fluxcdbot
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: fluxcdbot
  serviceName: fluxcdbot
  template:
    metadata:
      labels:
        app.kubernetes.io/name: fluxcdbot
    spec:
      containers:
      - image: squat/fluxcdbot:0b448e7b547140f9be992c28fdbab583082fb543
        name: fluxcdbot
        args:
        - --token=$(TOKEN)
        - --url=http://fluxcdbot.flux-system.svc.cluster.local
        env:
        - name: TOKEN
          valueFrom:
            secretKeyRef:
              name: telegram-token
              key: token
        ports:
        - containerPort: 8080
          name: http
        - containerPort: 9090
          name: internal
        volumeMounts:
        - name: data
          mountPath: /var/fluxcdbot
  volumeClaimTemplates:
  - metadata:
      labels:
        app.kubernetes.io/name: fluxcdbot
      name: data
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 1Gi
---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  creationTimestamp: null
  name: fluxcdbot
  namespace: flux-system
spec:
  encryptedData:
    address: AgBQhGnCtMN1RWjqNS6Q+wmekilClh53tl8wasOY5HjBLP6Dt5tluQOBMYKrx0jHGLZ89IUAJok52DMbOEdHh1gmhsp4ZcafJuVgSe/ssQ7eFG5wsuRqpIjU9k04Sm+q5hgTP4Del40BIejZwNxUHNaTTe8pBwNk/eD+w0C75MsCCJ4hVGAxpZyUFelIh2OUusQI5YW2e47KQ6L1RoRG3H6iEGAbwz9GDmuUdV/RtPKdttTnlwCnwCRxdccwrxrQtinKHWksEyKGex/+2Na78FVF85IiY89dFnAPvYQxqhJ+0wCIhtPDYu5bgkYgfm7k7+PzUBZ4/wwAGhVcySzgNZ3jcMgAsKYsQYK2XGR2j+5SuJBEzaRPlLEoLttZI9aE4K8SE2lRs454qLHlMYGKzMHrvNfPbviBixZ5USQO2k9skYB+uBMAbkIsQ2j+GSPe6zWlo5lbhiT8hO6bngquJV0esXqEoLMXrzov/NBfkYzaKYYO8a8afiu5FsptCYSLPROlm8EQBzQ8xVonfO1pH1poDO+eRT1YZjncE0o+sgjVeH111NGCxuHrDcooMuSM3bo41Yd/CUBvCYNW9HAjcQAVMx4ypuMYCqgxS6alWN6NuTRljvnwWGCDXXL4aBcLB50O1zX2/chuzx9sQ5ZfxxbSgtdu78G22cY+QiMjmc9CQpkehZ5ibd33Rm12LX1Evy5bCvMFEszwwBQY2htpQhIsuBBKkDAi1c+i3MFRtCJZpWHF6nMwj0YLIm8LrihWrhVGDMbdlb/gEQcdx5QIVHIhUi80sWORqoa6WA==
  template:
    data: null
    metadata:
      creationTimestamp: null
      name: fluxcdbot
      namespace: flux-system
