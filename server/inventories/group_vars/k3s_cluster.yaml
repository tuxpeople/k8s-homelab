cluster_name: k3s-prod
nfs_package: "nfs-utils"

# iscsi_package_debian: open-iscsi
# iscsi_package_redhat: iscsi-initiator-utils

k3s_server_manifests_urls:
  - url: https://raw.githubusercontent.com/tuxpeople/k8s-homelab/master/server/files/rbac.yaml
    filename: rbac.yaml
  - url: https://raw.githubusercontent.com/tuxpeople/k8s-homelab/master/server/files/vip.yaml
    filename: vip.yaml

k3s_install_hard_links: true
k3s_become_for_all: true
k3s_etcd_datastore: true
k3s_registration_address: "{{ vrrp_vip }}"
k3s_server:
  tls-san: "{{ vrrp_vip }},{{ cluster_name }}.{{ vrrp_vip }}.nip.io,k8s.sky.lab"
  disable:
    # Disable local-storage - replaced with nfs-client-provisioner and install with Flux
    - local-storage
    # Disable traefik - installed with Flux
    - traefik
    # Disable servicelb - replaced with metallb and install with Flux
    - servicelb
    # Disable metrics-server - installed with Flux
    - metrics-server
  bind-address: 0.0.0.0
  advertise-address: "{{ vrrp_vip }}"
  docker: false
  # Network CIDR to use for pod IPs
  cluster-cidr: "10.42.0.0/16"
  # Network CIDR to use for service IPs
  service-cidr: "10.43.0.0/16"
  kubelet-arg:
    # Enables the kubelet to gracefully evict pods during a node shutdown
    - "feature-gates=GracefulNodeShutdown=true"
    # Allow k8s services to contain TCP and UDP on the same port
    - "feature-gates=MixedProtocolLBService=true"
  # Required to monitor kube-controller-manager with kube-prometheus-stack
  kube-controller-manager-arg:
    - "address=0.0.0.0"
    - "bind-address=0.0.0.0"
  # Required to monitor kube-proxy with kube-prometheus-stack
  kube-proxy-arg:
    - "metrics-bind-address=0.0.0.0"
  # Required to monitor kube-scheduler with kube-prometheus-stack
  kube-scheduler-arg:
    - "address=0.0.0.0"
    - "bind-address=0.0.0.0"
  # Required to monitor etcd with kube-prometheus-stack
  etcd-expose-metrics: true
k3s_agent:
  node-label:
    - "region=sky"
  kubelet-arg:
    # Enables the kubelet to gracefully evict pods during a node shutdown
    - "feature-gates=GracefulNodeShutdown=true"
    # Allow k8s services to contain TCP and UDP on the same port
    - "feature-gates=MixedProtocolLBService=true"

firewall_services:
  - name: ssh
  - name: http
  - name: https
  - name: 6443
    protocol: tcp
  - name: 10250
    protocol: tcp
  - name: 2379
    protocol: tcp
  - name: 2380
    protocol: tcp
  - name: 7946
    protocol: tcp
  - name: 7946
    protocol: udp
  - name: 8472
    protocol: udp
  - name: 9100
    protocol: tcp
  - name: 30022
    protocol: tcp
  - name: 30053
    protocol: udp
  - name: 32400
    protocol: tcp
  - name: 32410
    protocol: tcp
  - name: 32412
    protocol: tcp
  - name: 32413
    protocol: tcp
  - name: 32414
    protocol: tcp
  - name: 9001
    protocol: tcp
  - name: 9002
    protocol: tcp
  - name: 9003
    protocol: tcp
  - name: 9004
    protocol: tcp
  - name: 9005
    protocol: tcp
  - name: 9006
    protocol: tcp
  - name: 9007
    protocol: tcp
  - name: 9008
    protocol: tcp
  - name: 9009
    protocol: tcp
  - name: 9010
    protocol: tcp
  - name: 9011
    protocol: tcp
  - name: 9012
    protocol: tcp
  - name: 9013
    protocol: tcp
  - name: 9014
    protocol: tcp
  - name: 9015
    protocol: tcp
  - name: 9016
    protocol: tcp
  - name: 9017
    protocol: tcp
  - name: 9018
    protocol: tcp
  - name: 9019
    protocol: tcp
  - name: 9020
    protocol: tcp
  - name: 9021
    protocol: tcp
  - name: 9022
    protocol: tcp
  - name: 9002
    protocol: udp

local_kubeconfig: /Users/tdeutsch/iCloudDrive/Allgemein/kubectl/homelab.yaml
sealed_secrets_key: /Users/tdeutsch/git/ansible-sky/master.yaml
github_user: tuxpeople
github_repo: k8s-server
github_token: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          37613230643433373733373737626135653665393966363432616466383465366332616234366132
          6230396266343038346466376234326338653462326637630a306137333734333130336239643966
          65636635313836393834363437333263643832613233373131623434646135613736626237663432
          6532323435663463370a666361613266626535613933393536333831373937616162383736666463
          33383266623436356134633333613165376234636532636332366233623634646336343263323363
          3232653538383265393966666532363839353937346639306162
