# Übersicht der YAML-Checks

Kurzer Überblick über alle automatisierten Prüfungen, die sich um deine YAML-Dateien kümmern. Ich habe die Liste nach lokalen Pre-Commit-Hooks und den GitHub Actions Workflows aufgeteilt und jeweils den verwendeten Tooling-Stack samt Einsatzzweck beschrieben.

## Pre-Commit-Hooks (`.pre-commit-config.yaml`)

| Hook / Tool                                                                                                        | Einsatzzweck                                                                                                                                     |
| ------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| `trailing-whitespace`, `end-of-file-fixer`                                                                         | Hält generische Dateien – inklusive YAML – sauber von Nachlauf-Whitespace und fehlenden Zeilenumbrüchen.                                         |
| `check-merge-conflict`, `check-added-large-files`                                                                  | Verhindert, dass Konfliktmarker bzw. versehentlich riesige Artefakte in YAML-Manifeste gelangen.                                                 |
| `check-yaml`                                                                                                       | Prüft die grundlegende YAML-Syntax für alle nicht verschlüsselten bzw. nicht generierten Dateien.                                                |
| `yamllint` (strict)                                                                                                | Erzwingt einheitlichen YAML-Stil und Schema-Validierung nach Yamllint-Regeln.                                                                    |
| `kubernetes-yaml-validate` (custom)                                                                                | Lädt jede Datei unter `kubernetes/` und stellt über `yq eval` sicher, dass sie syntaktisch korrekt ist; SOPS-Dateien werden bewusst ausgelassen. |
| `flux-check` (custom)                                                                                              | Gibt einen Hinweis aus, Flux-spezifische Health-Checks (`task validate:flux`) zu fahren, sobald `flux` CLI und `kubeconfig` vorhanden sind.      |
| `check-json`                                                                                                       | Absichert JSON-Schnipsel (z. B. in Helm-Werten), die oft zusammen mit YAML gepflegt werden.                                                      |
| `check-case-conflict`, `check-symlinks`, `check-executables-have-shebangs`, `check-shebang-scripts-are-executable` | Infrastruktur-Hooks, die Dateikonflikte oder fehlerhafte Symlinks in YAML-orientierten Verzeichnissen verhindern.                                |
| `shellcheck`                                                                                                       | Bewahrt deine YAML-generierenden Shell-Skripte vor Fehlern, bevor sie Manifestdateien erstellen.                                                 |
| `markdownlint`                                                                                                     | Stellt sicher, dass begleitende Dokumentation zu YAML (Runbooks, README) konsistent bleibt.                                                      |
| `detect-secrets`                                                                                                   | Durchsucht auch YAML-Dateien nach möglichen Klartext-Geheimnissen und verlangt, dass echte Secrets via SOPS verschlüsselt werden.                |

## GitHub Actions Workflows

| Workflow                                                                     | Tooling                                      | Zweck für YAML                                                                                                                                                                                                                                                                                                                                                                         |
| ---------------------------------------------------------------------------- | -------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Validation` (`.github/workflows/validation.yaml`)                           | `yq`, Shell-Skripte                          | Läuft bei PRs manuellen Triggern. Der Job „Check SOPS Encryption“ verhindert unverschlüsselte `Secret`-Manifeste und prüft ENC-Marker. „Validate YAML Syntax“ parst alle YAML-/YML-Dateien (ohne `.sops`) per `yq`. |
| `Flux Local` (`.github/workflows/flux-local.yaml`)                           | `flux-local` Docker-Image                    | Testet und diff’t Flux-Kustomizations/HelmReleases lokal. Der `test`-Schritt simuliert `flux build` (`--enable-helm`) und der `diff`-Schritt zeigt Abweichungen zwischen PR- und Default-Branch-Manifests.                                                                                                                                                                             |
| `App Template Validation` (`.github/workflows/app-template-validation.yaml`) | `ajv-cli`, `yq`, `curl`                      | Identifiziert App-Template-Verzeichnisse (`helmrelease.yaml` + schema-kommentiertes `values.yaml`), lädt das referenzierte JSON-Schema und validiert die Werte-Datei gegen dieses Schema; warnt zusätzlich, wenn Chart- und Schema-Version auseinanderlaufen.                                                                                                                          |
| `Check Talconfig` (`.github/workflows/check_talconfig.yaml`)                 | `talhelper validate`, `yq`                   | Prüft `talos/talconfig.yaml` mithilfe von `talhelper validate` (inkl. Versionen aus `talenv.yaml`). Fehler im Talos- oder Kubernetes-YAML tauchen so schon im PR auf.                                                                                                                                                                                                                  |

Damit hast du auf einen Blick, welche Tools wann greifen und wodurch deine YAML-Manifeste abgesichert werden – lokal vor dem Commit und anschliessend nochmal zentral in GitHub.
