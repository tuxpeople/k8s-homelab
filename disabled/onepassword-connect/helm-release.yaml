---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: 1password-connect
  namespace: kube-system
spec:
  chart:
    spec:
      # renovate: registryUrl=https://1password.github.io/connect-helm-charts/
      chart: connect
      version: 1.6.0
      sourceRef:
        kind: HelmRepository
        name: 1password
        namespace: flux-system
      interval: 5m
  releaseName: 1password-connect
  targetNamespace: kube-system
  interval: 5m
  test:
    enable: false # Enable helm test
  install:
    remediation: # perform remediation when helm install fails
      retries: 6
  upgrade:
    remediation: # perform remediation when helm upgrade fails
      retries: 3
      remediateLastFailure: true # remediate the last failure, when no retries remain
    cleanupOnFail: true
  rollback:
    timeout: 10m
    cleanupOnFail: true
    recreate: true
  values:
    namespace: kube-system
    connect:
      credentialsName: op-credentials
      credentialsKey: 1password-credentials.json
    operator:
      create: true
      autoRestart: true
      token:
        name: op-token
        key: token
      pollingInterval: 10
      serviceAccount:
        create: true
      roleBinding:
        create: true
      clusterRole:
        create: true
    service:
      type: ClusterIP
      port: 8080
---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  creationTimestamp: null
  name: op-token
  namespace: kube-system
spec:
  encryptedData:
    token: AgAzrPoeURKmk3CG4sA3aSN5mjW8zOMQ8MZt61pQBIATC20PSdeP/VsC82ZWEv+isX+V/YWk48k+P1q2vwkkFGwSlpYCYWrwASOLK6TxJtktShWzrnDrRwWMgov4bR3913NsGCysjB3aTmF8PGov7PUCLh9SvPVK8ZJwJkJejbynyb2gSg6ni4ekEf8hZYqPZpmZlHnlQdRlvGsWZ19F/PTmRHzXRHqYsLXY+xQk73/VP6KDTs4Dhjb51ggPgLHcy+E9YaS1uYQNeGI9M7Lfc36gWkZJc2vs9AIAnckx0ZGN8UmlLO0HHyaV/lxs2S92ZblGhq+pmofNU1IwhwWsQ0RUdPrhuxwUBfWYP0KL1alcYk200P542tIA+7+Nvu9zA3JhIMfq9BqRFImVgH7dS6JKTO0KSwnHzR05DHul63Ur7KE6MxEaIF1KLiA54/JWfRR2LN+3OVFS3nW96ucqbzUXEMHzK+U37ZQ7TptGFAbzxzdwz2iJlbgtbbvN9dk/QgbXfHXMb6ns8jhWH7bx+9v/zoZ+Q0Mj50Gp1eSNMudpgw0M1Je1+wCetoU7INltCyHpohVKbFsx89JHHFEQRu9Z7ujYQm3tl5lZIBHojIYxlpSBhQv53xR4wtsrGPyVWa4Q0evm+YmSQ611zSr8czLAoTLzTvA5FdLFZqWhPFH/YBGVKymeKdj3pIrsueT/g7W1IIcnsrUye5brKu2yRkk2MGWHzeob5COCJaikWb7LAjE4KhoFGlUXXrHZW2UaBGtThVrBGjwMgcJ9RU/vk5A1cxVNoGEpmTgvRldy8+Kp79C4aNgXErn/2cpEI1JjGdXYvARf2ze7NNbyW1NBb48e4bGvaHW3J7HMXQj7RzOZ09k4iwqt0OP0MuhV0EFPhJanEbrvVIC6/5e16VJxb3Y/yNABcT8cetuuHLvJdhHeHhkuSulXQmhWqGKQ65QMuR8r1g2GCAcIYoBXdx32zsCbXgk48MrZcqcKcoe6kuszC17MHg0XCzomTDODIPHxqN/PFmL/HMQF2VTkMM65ZI3MXGrs0mx+O59O32ZyN4+b2vL7qzi+xo5ZazYzK9jW/VNHv9kfMcQsJDD7hM+TjciqelKnC4jjWelJqJotQk+Cav3ScRdm774D4NFeErQg9OmiRmVp0ctDkKu3zM7DiTbpYMIhaJd33623vc+Gng/yLuILG0yeJYa/0fJ36gcJt3eGmCqHcMOF8oMLzpqGwuSWlPFtLc3+53IUqALAVmftHvd/ZW8otDpvWUjkLSa5bvllFldv3wdCPo7p96GKzhj59jyUBy8mEFkBJuYOWNUhO31MHrajhJ+psMzcqSgiK9gNXQ/GHFRTz3hzkm/fTueCcUsAzsbULkyL9wyYg9AkEp2eilOspNt1apEu5lu3CPBtIi8l4eAH3Xignca9sPKXU3oQPxM685B6PkA/WxfSJfxaZB/Z3jkt4vIm+9RjvrhQG5Z5k09I+hv3W6LJnVSclo1Uclg9P6lh48G2gu021MKAO2QMnYM4KDGy6yKLROlNM/I2c2Sl5HsQBa3QJe5QEgDMDyPsAyxdNw==
  template:
    data: null
    metadata:
      creationTimestamp: null
      name: op-token
      namespace: kube-system
---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  creationTimestamp: null
  name: op-credentials
  namespace: kube-system
spec:
  encryptedData:
    1password-credentials.json: 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
  template:
    data: null
    metadata:
      creationTimestamp: null
      name: op-credentials
      namespace: kube-system
    type: Opaque
---
apiVersion: onepassword.com/v1
kind: OnePasswordItem
metadata:
  namespace: kube-system
  name: ichbineintest
spec:
  itemPath: "vaults/homelab/items/test-secret"
