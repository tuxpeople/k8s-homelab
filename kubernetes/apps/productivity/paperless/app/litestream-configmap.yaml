---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/v1/configmap_v1.json
apiVersion: v1
kind: ConfigMap
metadata:
  name: paperless-litestream-config
data:
  # Phase 2: Replicate from Longhorn location
  litestream-replicate.yml: |
    dbs:
      - path: /data/db.sqlite3
        replicas:
          - name: minio
            type: s3
            endpoint: $${MINIO_ENDPOINT}
            bucket: $${MINIO_BUCKET}
            path: paperless
            force-path-style: true
            retention: 168h
            validation-interval: 24h
            sync-interval: 10s
  # Phase 2: Restore from MinIO to Longhorn
  litestream-restore.yml: |
    dbs:
      - path: /data/db.sqlite3
        replicas:
          - name: minio
            type: s3
            endpoint: $${MINIO_ENDPOINT}
            bucket: $${MINIO_BUCKET}
            path: paperless
            force-path-style: true
