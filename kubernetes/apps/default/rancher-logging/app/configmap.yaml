---
apiVersion: v1
kind: ConfigMap
metadata:
  annotations:
    kustomize.toolkit.fluxcd.io/substitute: disabled
  name: script-configmap
data:
  garbagecollect.sh: |-
    #!/bin/sh
    echo "Checking for workdir"
    [ -d /mnt/workdir ] || exit 1
    echo "Deleting files in workdir older than ${KEEP_DAYS} days"
    find /mnt/workdir -type f -mtime +${KEEP_DAYS} -delete
    echo "Deleting empty directories in workdir"
    find /mnt/workdir -empty -type d -delete
    echo "Finished"
