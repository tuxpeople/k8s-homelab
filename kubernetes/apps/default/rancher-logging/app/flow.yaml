---
apiVersion: logging.banzaicloud.io/v1beta1
kind: Output
metadata:
  name: s3-output
spec:
  s3:
    aws_key_id:
      valueFrom:
        secretKeyRef:
          name: logging-s3
          key: awsAccessKeyId
    aws_sec_key:
      valueFrom:
        secretKeyRef:
          name: logging-s3
          key: awsSecretAccessKey
    s3_bucket: test
    s3_region: test_region
    s3_endpoint: "http://minio.default.svc.cluster.local:9000"
    force_path_style: "true"
    path: "logs/${tag}/%Y/%m/%d/"
    buffer:
      timekey: 10s
      timekey_wait: 0s
      timekey_use_utc: true
---
apiVersion: logging.banzaicloud.io/v1beta1
kind: Flow
metadata:
  name: flow-test
spec:
  # filters:
  #   - parser:
  #       remove_key_name_field: true
  #       parse:
  #         type: nginx
  #   - tag_normaliser:
  #       format: ${namespace_name}.${pod_name}.${container_name}
  localOutputRefs:
    - s3-output
  match:
    - select:
        labels:
          app: helm-controller
