# yaml-language-server: $schema=https://raw.githubusercontent.com/codecentric/helm-charts/master/charts/keycloakx/values.schema.json

replicas: 1

image:
  repository: quay.io/keycloak/keycloak
  tag: 26.4.2
  pullPolicy: IfNotPresent

args:
  - start

resources:
  requests:
    cpu: 250m
    memory: 512Mi
  limits:
    cpu: 1000m
    memory: 2Gi

dbchecker:
  enabled: true

cache:
  stack: jdbc-ping

database:
  vendor: postgres
  hostname: keycloak-db
  port: 5432
  database: keycloak
  username: keycloak
  existingSecret: keycloak.keycloak-db.credentials.postgresql.acid.zalan.do
  existingSecretKey: password

extraEnv: |
  - name: KEYCLOAK_ADMIN
    valueFrom:
      secretKeyRef:
        name: keycloak-admin
        key: username
  - name: KEYCLOAK_ADMIN_PASSWORD
    valueFrom:
      secretKeyRef:
        name: keycloak-admin
        key: password
  - name: KC_HOSTNAME
    value: keycloak.${SECRET_DOMAIN}
  - name: KC_PROXY
    value: edge
  - name: KC_PROXY_HEADERS
    value: xforwarded
  - name: KC_HTTP_ENABLED
    value: "true"
  - name: KC_HTTP_RELATIVE_PATH
    value: /

http:
  relativePath: "/"

ingress:
  enabled: true
  ingressClassName: internal
  annotations:
    hajimari.io/icon: mdi:key
  rules:
    - host: keycloak.${SECRET_DOMAIN}
      paths:
        - path: /
          pathType: Prefix
  tls:
    - hosts:
        - keycloak.${SECRET_DOMAIN}
      secretName: ${SECRET_DOMAIN/./-}-production-tls
